!function(r,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Fahrplan=t():r.Fahrplan=t()}(this,function(){return function(r){function t(n){if(e[n])return e[n].exports;var a=e[n]={exports:{},id:n,loaded:!1};return r[n].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var e={};return t.m=r,t.c=e,t.p="",t(0)}([function(r,t,e){"use strict";function n(r){function t(t){return o(s+"/location.name?"+a.stringify({authKey:r,input:t,format:"json"})).then(function(r){return r.api=d,r}).then(i.station)}function e(r){return t(r).then(function(r){return r.stations.length?r.stations[0]:null})}function n(t,n,c){var f;if("departures"===t)f="/departureBoard";else{if("arrivals"!==t)throw new Error('Type must be either "departures" or "arrivals"');f="/arrivalBoard"}c||(c=Date.now());var h;return h=n.id&&u.test(n.id)?n:u.test(n)?{id:n}:"function"==typeof n.then?n:e(n.name?n.name:""+n),Promise.resolve(h).then(function(t){return o(s+f+"?"+a.stringify({authKey:r,id:t.id,date:p.formatDate(c),time:p.formatTime(c),format:"json"}))}).then(function(r){return r.api=d,r}).then(i.stationBoard)}function c(r){return o(r).then(function(r){return r.api=d,r}).then(i.itinerary)}if(!r)throw new Error("No API key provided");var d={station:{find:t,get:e},departure:{find:function(r,t){return n("departures",r,t)}},arrival:{find:function(r,t){return n("arrivals",r,t)}},itinerary:{get:c}};return d}var a=e(1),o=e(2),i=e(4),p=e(5),s="http://open-api.bahn.de/bin/rest.exe",u=/^\d{9}$/;r.exports=n},function(r,t){"use strict";r.exports={stringify:function(r,t,e){function n(r,t){return encodeURIComponent(r)+e+encodeURIComponent(t)}t||(t="&"),e||(e="=");var a=[],o=Object.keys(r);return o.forEach(function(t){var e=r[t];Array.isArray(e)?e.forEach(function(r){a.push(n(t,r))}):a.push(n(t,e))}),a.join(t)}}},function(r,t,e){"use strict";r.exports=e(3)},function(r,t){"use strict";r.exports=function(r){return new Promise(function(t,e){var n=new XMLHttpRequest,a=r.split(":").shift().toLowerCase();if("https"!==a&&"http"!==a)throw new Error("Unsupported protocol ("+a+")");n.open("GET",r,!0),n.onload=function(){t({data:n.responseText})},n.onerror=e,n.send()})}},function(r,t,e){"use strict";function n(r,t){var e={};return e.name=r.name,e.latitude=parseFloat(r.lat),e.longitude=parseFloat(r.lon),r.id&&(e.id=r.id),r.type&&(e.type=r.type),t&&"number"!=typeof t&&(e.departure={find:function(r){return t.departure.find(e.id,r)}},e.arrival={find:function(r){return t.arrival.find(e.id,r)}}),e}function a(r,t){var e={};return e.name=r.name,e.type=r.type,e.station={name:r.stop,id:r.stopid},t===p&&(e.arrival=i.parse(r.date,r.time)),t===s&&(e.departure=i.parse(r.date,r.time)),r.origin&&(e.origin=r.origin),r.direction&&(e.destination=r.direction),e.platform=r.track,e}function o(r){var t={};return Object.keys(r).forEach(function(e){if(r.hasOwnProperty(e)){var n=r[e];"routeIdxFrom"===e?t.fromIndex=parseInt(n,10):"routeIdxTo"===e?t.toIndex=parseInt(n,10):"priority"===e?t.priority=parseInt(n,10):"$"===e?t.description=n:t[e]=n}}),t}var i=e(5),p="ARRIVAL",s="DEPARTURE";r.exports={station:function(r){if(!r.hasOwnProperty("data"))throw new Error("Expected a response object with a data property");var t=JSON.parse(r.data),e=t.LocationList.StopLocation||[],a=t.LocationList.CoordLocation||[];e.hasOwnProperty("length")||(e=[e]),a.hasOwnProperty("length")||(a=[a]);var o={stations:e.map(function(t){return n(t,r.api)}),places:a.map(n)};return o},stationBoard:function(r){if(!r.hasOwnProperty("data"))throw new Error("Expected a response object with a data property");var t,e,n,o=JSON.parse(r.data);if(o.ArrivalBoard)t=o.ArrivalBoard.Arrival,e=p;else if(o.DepartureBoard)t=o.DepartureBoard.Departure,e=s;else{if(!o.Error)throw new Error("Expected an ArrivalBoard or DepartureBoard, got "+o);n=new Error("API Error ("+o.Error.code+")"),n.code=o.Error.code,n.data=o.Error}return t||(t=[]),t.hasOwnProperty("length")||(t=[t]),t.map(function(t){var n=a(t,e);return r.api&&t.JourneyDetailRef&&(n.itinerary={get:function(){return r.api.itinerary.get(t.JourneyDetailRef.ref)}}),n})},itinerary:function(r){if(!r.hasOwnProperty("data"))throw new Error("Expected a response object with a data property");var t,e,a,p,s,u=JSON.parse(r.data);try{t=u.JourneyDetail.Stops.Stop}catch(c){t=[]}try{e=u.JourneyDetail.Names.Name}catch(c){e=[]}try{a=u.JourneyDetail.Types.Type}catch(c){a=[]}try{p=u.JourneyDetail.Operators.Operator}catch(c){p=[]}try{s=u.JourneyDetail.Notes.Note}catch(c){s=[]}return t.hasOwnProperty("length")||(t=[t]),e.hasOwnProperty("length")||(e=[e]),a.hasOwnProperty("length")||(a=[a]),p.hasOwnProperty("length")||(p=[p]),s.hasOwnProperty("length")||(s=[s]),t=t.map(function(t){var e={station:n(t,r.api),index:parseInt(t.routeIdx),platform:t.track};return t.depTime&&(e.departure=i.parse(t.depDate,t.depTime)),t.arrTime&&(e.arrival=i.parse(t.arrDate,t.arrTime)),e}),{stops:t,names:e.map(o),types:a.map(o),operators:p.map(o),notes:s.map(o)}}}},function(r,t){"use strict";function e(r,t){for(void 0===t&&(t=2),r=""+r;r.length<t;)r="0"+r;return r}r.exports={formatDate:function(r){r=new Date(r);var t=e(r.getDate()),n=e(r.getMonth()+1),a=e(r.getFullYear(),4);return[a,n,t].join("-")},formatTime:function(r){r=new Date(r);var t=e(r.getHours()),n=e(r.getMinutes());return t+":"+n},parse:function(r,t){r=r.split("-"),t=t.split(":");var e=parseInt(r[0],10),n=parseInt(r[1],10)-1,a=parseInt(r[2],10),o=parseInt(t[0],10),i=parseInt(t[1],10);return new Date(e,n,a,o,i)}}}])});